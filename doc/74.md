# 基于双重zookeeper分布式锁完成分布式并行缓存预热的代码开发

1、服务启动的时候，进行缓存预热

2、从zk中读取taskId列表

3、依次遍历每个taskId，尝试获取分布式锁，如果获取不到，快速报错，不要等待，因为说明已经有其他服务实例在预热了

4、直接尝试获取下一个taskId的分布式锁

5、即使获取到了分布式锁，也要检查一下这个taskId的预热状态，如果已经被预热过了，就不再预热了

6、执行预热操作，遍历productId列表，查询数据，然后写ehcache和redis

7、预热完成后，设置taskId对应的预热状态